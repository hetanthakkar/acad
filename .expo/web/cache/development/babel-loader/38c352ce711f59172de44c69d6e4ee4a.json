{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\codemaxx\\\\Desktop\\\\iBlood\\\\screens\\\\Attendees.js\",\n    _class,\n    _temp;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Animated from \"react-native-web/dist/exports/Animated\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport AsyncStorage from \"react-native-web/dist/exports/AsyncStorage\";\nimport LayoutAnimation from \"react-native-web/dist/exports/LayoutAnimation\";\nimport { View as AnimatableView } from 'react-native-animatable';\nimport { Searchbar } from 'react-native-paper';\nimport { withNavigation } from 'react-navigation';\nimport { Query } from 'react-apollo';\nimport _ from 'lodash';\nimport NavigationBar from \"../components/NavigationBar\";\nimport MenuButton from \"../components/MenuButton\";\nimport AttendeesSearchResults from \"../components/AttendeesSearchResults\";\nimport { GQL } from \"../constants\";\nimport { Colors, Layout } from \"../constants\";\nimport GET_ATTENDEES from \"../data/attendeesquery\";\nimport { getContactTwitter } from \"../utils\";\n\nvar Attendees = function (_React$Component) {\n  _inherits(Attendees, _React$Component);\n\n  var _super = _createSuper(Attendees);\n\n  function Attendees(props) {\n    var _this;\n\n    _classCallCheck(this, Attendees);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      scrollY: new Animated.Value(0),\n      attendees: [],\n      aquery: ''\n    };\n    _this.throttleDelayMs = 200;\n    _this.throttleTimeout = null;\n\n    _this.queryThrottle = function (text) {\n      clearTimeout(_this.throttleTimeout);\n      _this.throttleTimeout = setTimeout(function () {\n        LayoutAnimation.easeInEaseOut();\n\n        _this.setState({\n          aquery: text\n        });\n      }, _this.throttleDelayMs);\n    };\n\n    return _this;\n  }\n\n  _createClass(Attendees, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var scrollY = this.state.scrollY;\n      var headerOpacity = scrollY.interpolate({\n        inputRange: [0, 150],\n        outputRange: [0, 1],\n        extrapolate: 'clamp'\n      });\n      return React.createElement(View, {\n        style: {\n          flex: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 7\n        }\n      }, React.createElement(Searchbar, {\n        onChangeText: function onChangeText(text) {\n          return _this2.queryThrottle(text);\n        },\n        placeholder: \"Search for conference attendees\",\n        style: styles.textInput,\n        autoCapitalize: \"none\",\n        autoCorrect: false,\n        clearButtonMode: \"while-editing\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 9\n        }\n      }), React.createElement(DeferredAttendeesContent, {\n        aquery: this.state.aquery,\n        event: this.props.screenProps.event,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 9\n        }\n      }), React.createElement(OverscrollView, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return Attendees;\n}(React.Component);\n\nAttendees.navigationOptions = {\n  title: 'Attendees'\n};\n\nvar DeferredAttendeesContent = withNavigation(_class = (_temp = function (_React$Component2) {\n  _inherits(DeferredAttendeesContent, _React$Component2);\n\n  var _super2 = _createSuper(DeferredAttendeesContent);\n\n  function DeferredAttendeesContent(props) {\n    var _this3;\n\n    _classCallCheck(this, DeferredAttendeesContent);\n\n    _this3 = _super2.call(this, props);\n    _this3.state = {\n      ready: Platform.OS === 'android' ? false : true,\n      uuid: ''\n    };\n\n    _this3._handlePressRow = function (attendee) {\n      _this3.props.navigation.navigate('AttendeeDetail', {\n        attendee: attendee\n      });\n    };\n\n    _this3._getUuid();\n\n    return _this3;\n  }\n\n  _createClass(DeferredAttendeesContent, [{\n    key: \"_getUuid\",\n    value: function _getUuid() {\n      var _this4 = this;\n\n      var value, tickets, uuid;\n      return _regeneratorRuntime.async(function _getUuid$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('@MySuperStore2019:tickets'));\n\n            case 2:\n              value = _context.sent;\n              tickets = JSON.parse(value) || [];\n              uuid = '';\n              tickets.map(function (ticket) {\n                ticket.checkinLists.map(function (ch) {\n                  if (ch.mainEvent) {\n                    uuid = ticket.uuid;\n\n                    _this4.setState({\n                      uuid: uuid\n                    });\n                  }\n                });\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this5 = this;\n\n      if (this.state.ready) {\n        return;\n      }\n\n      setTimeout(function () {\n        return _this5.setState({\n          ready: true\n        });\n      }, 200);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      if (!this.state.ready) {\n        return null;\n      }\n\n      var aquery = this.props.aquery;\n      var cleanedQuery = aquery.toLowerCase().trim();\n      var uuid = this.state.uuid;\n      var vars = {\n        slug: GQL.slug,\n        q: 'a',\n        uuid: uuid\n      };\n      return React.createElement(AnimatableView, {\n        animation: \"fadeIn\",\n        useNativeDriver: true,\n        duration: 800,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 7\n        }\n      }, uuid != '' ? React.createElement(Query, {\n        query: GET_ATTENDEES,\n        variables: vars,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }\n      }, function (_ref) {\n        var loading = _ref.loading,\n            error = _ref.error,\n            data = _ref.data;\n\n        if (error) {\n          return React.createElement(Text, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 24\n            }\n          }, \"Error $\", error);\n        }\n\n        var attendees = data && data.events && data.events[0] ? data.events[0].attendees : [];\n        var attendeesData;\n\n        if (cleanedQuery === '') {\n          attendeesData = _.orderBy(attendees, function (attendee) {\n            return attendee.firstName + \" \" + attendee.lastName;\n          }, ['asc']);\n        } else {\n          var filteredAttendees = [];\n          var attendeesSearchRankingScore = {};\n          attendees.forEach(function (attendee) {\n            var fullName = attendee.firstName + \" \" + attendee.lastName;\n            var matchesName = fullName.toLowerCase().trim().includes(cleanedQuery);\n            var matchesEmail = attendee.email.toLowerCase().trim().includes(cleanedQuery);\n            var matchesTwitter = getContactTwitter(attendee).toLowerCase().trim().includes(cleanedQuery);\n            attendeesSearchRankingScore[\"\" + attendee.id] = 0;\n\n            if (matchesName || matchesEmail || matchesTwitter) {\n              filteredAttendees.push(attendee);\n            }\n\n            if (matchesName) {\n              attendeesSearchRankingScore[\"\" + attendee.id] += 1;\n            }\n\n            if (matchesEmail) {\n              attendeesSearchRankingScore[\"\" + attendee.id] += 1;\n            }\n\n            if (matchesTwitter) {\n              attendeesSearchRankingScore[\"\" + attendee.id] += 1;\n            }\n          });\n\n          var sortedFilteredAttendees = _.orderBy(filteredAttendees, function (attendee) {\n            return attendeesSearchRankingScore[\"\" + attendee.id];\n          }, ['desc']);\n\n          attendeesData = sortedFilteredAttendees;\n        }\n\n        return React.createElement(AttendeesSearchResults, {\n          attendees: attendeesData,\n          onPress: _this6._handlePressRow,\n          searchQuery: cleanedQuery,\n          isLoading: loading,\n          event: _this6.props.event,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 17\n          }\n        });\n      }) : null);\n    }\n  }]);\n\n  return DeferredAttendeesContent;\n}(React.Component), _temp)) || _class;\n\nvar OverscrollView = function OverscrollView() {\n  return React.createElement(View, {\n    style: {\n      position: 'absolute',\n      top: -400,\n      height: 400,\n      left: 0,\n      right: 0,\n      backgroundColor: Colors.blue\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 3\n    }\n  });\n};\n\nvar styles = StyleSheet.create({\n  textInput: {\n    height: 60,\n    position: 'absolute',\n    top: Layout.notchHeight,\n    left: 0,\n    right: 0,\n    marginLeft: 6,\n    marginRight: 6,\n    zIndex: 10,\n    backgroundColor: 'white',\n    padding: 5,\n    borderRadius: 4,\n    borderWidth: 0,\n    borderColor: 'black'\n  }\n});\nexport default Attendees;","map":{"version":3,"sources":["C:/Users/codemaxx/Desktop/iBlood/screens/Attendees.js"],"names":["React","View","AnimatableView","Searchbar","withNavigation","Query","_","NavigationBar","MenuButton","AttendeesSearchResults","GQL","Colors","Layout","GET_ATTENDEES","getContactTwitter","Attendees","props","state","scrollY","Animated","Value","attendees","aquery","throttleDelayMs","throttleTimeout","queryThrottle","text","clearTimeout","setTimeout","LayoutAnimation","easeInEaseOut","setState","headerOpacity","interpolate","inputRange","outputRange","extrapolate","flex","styles","textInput","screenProps","event","Component","navigationOptions","title","DeferredAttendeesContent","ready","Platform","OS","uuid","_handlePressRow","attendee","navigation","navigate","_getUuid","AsyncStorage","getItem","value","tickets","JSON","parse","map","ticket","checkinLists","ch","mainEvent","cleanedQuery","toLowerCase","trim","vars","slug","q","loading","error","data","events","attendeesData","orderBy","firstName","lastName","filteredAttendees","attendeesSearchRankingScore","forEach","fullName","matchesName","includes","matchesEmail","email","matchesTwitter","id","push","sortedFilteredAttendees","OverscrollView","position","top","height","left","right","backgroundColor","blue","StyleSheet","create","notchHeight","marginLeft","marginRight","zIndex","padding","borderRadius","borderWidth","borderColor"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {\r\n  Animated,\r\n  Platform,\r\n  Text,\r\n  StyleSheet,\r\n  View,\r\n  AsyncStorage,\r\n  LayoutAnimation,\r\n} from 'react-native';\r\nimport {View as AnimatableView} from 'react-native-animatable';\r\nimport {Searchbar} from 'react-native-paper';\r\nimport {withNavigation} from 'react-navigation';\r\nimport {Query} from 'react-apollo';\r\nimport _ from 'lodash';\r\n\r\nimport NavigationBar from '../components/NavigationBar';\r\nimport MenuButton from '../components/MenuButton';\r\nimport AttendeesSearchResults from '../components/AttendeesSearchResults';\r\n\r\nimport {GQL} from '../constants';\r\nimport {Colors, Layout} from '../constants';\r\nimport GET_ATTENDEES from '../data/attendeesquery';\r\nimport {getContactTwitter} from '../utils';\r\n\r\nclass Attendees extends React.Component {\r\n  static navigationOptions = {\r\n    title: 'Attendees',\r\n  };\r\n\r\n  state = {\r\n    scrollY: new Animated.Value(0),\r\n    attendees: [],\r\n    aquery: '',\r\n  };\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  throttleDelayMs = 200;\r\n  throttleTimeout = null;\r\n  queryThrottle = text => {\r\n    clearTimeout(this.throttleTimeout);\r\n\r\n    this.throttleTimeout = setTimeout(() => {\r\n      LayoutAnimation.easeInEaseOut();\r\n      this.setState({aquery: text});\r\n    }, this.throttleDelayMs);\r\n  };\r\n\r\n  render() {\r\n    const {scrollY} = this.state;\r\n    const headerOpacity = scrollY.interpolate({\r\n      inputRange: [0, 150],\r\n      outputRange: [0, 1],\r\n      extrapolate: 'clamp',\r\n    });\r\n    return (\r\n      <View style={{flex: 1}}>\r\n        <Searchbar\r\n          onChangeText={text => this.queryThrottle(text)}\r\n          placeholder=\"Search for conference attendees\"\r\n          style={styles.textInput}\r\n          autoCapitalize=\"none\"\r\n          autoCorrect={false}\r\n          clearButtonMode=\"while-editing\"\r\n        />\r\n        <DeferredAttendeesContent\r\n          aquery={this.state.aquery}\r\n          event={this.props.screenProps.event}\r\n        />\r\n        <OverscrollView />\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\n@withNavigation\r\nclass DeferredAttendeesContent extends React.Component {\r\n  state = {\r\n    ready: Platform.OS === 'android' ? false : true,\r\n    uuid: '',\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this._getUuid();\r\n  }\r\n\r\n  async _getUuid() {\r\n    const value = await AsyncStorage.getItem('@MySuperStore2019:tickets');\r\n    let tickets = JSON.parse(value) || [];\r\n    let uuid = '';\r\n    tickets.map(ticket => {\r\n      ticket.checkinLists.map(ch => {\r\n        if (ch.mainEvent) {\r\n          uuid = ticket.uuid;\r\n          this.setState({uuid: uuid});\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.state.ready) {\r\n      return;\r\n    }\r\n    setTimeout(() => this.setState({ready: true}), 200);\r\n  }\r\n\r\n  _handlePressRow = attendee => {\r\n    this.props.navigation.navigate('AttendeeDetail', {attendee});\r\n  };\r\n\r\n  render() {\r\n    if (!this.state.ready) {\r\n      return null;\r\n    }\r\n    const {aquery} = this.props;\r\n    const cleanedQuery = aquery.toLowerCase().trim();\r\n    const uuid = this.state.uuid;\r\n    const vars = {slug: GQL.slug, q: 'a', uuid: uuid};\r\n    // console.log(GET_ATTENDEES, vars);\r\n    return (\r\n      <AnimatableView animation=\"fadeIn\" useNativeDriver duration={800}>\r\n        {uuid != '' ? (\r\n          <Query query={GET_ATTENDEES} variables={vars}>\r\n            {({loading, error, data}) => {\r\n              if (error) {\r\n                return <Text>Error ${error}</Text>;\r\n              }\r\n\r\n              const attendees =\r\n                data && data.events && data.events[0]\r\n                  ? data.events[0].attendees\r\n                  : [];\r\n              let attendeesData;\r\n              if (cleanedQuery === '') {\r\n                attendeesData = _.orderBy(\r\n                  attendees,\r\n                  attendee => `${attendee.firstName} ${attendee.lastName}`,\r\n                  ['asc']\r\n                );\r\n              } else {\r\n                const filteredAttendees = [];\r\n                const attendeesSearchRankingScore = {};\r\n                attendees.forEach(attendee => {\r\n                  const fullName = `${attendee.firstName} ${attendee.lastName}`;\r\n                  const matchesName = fullName\r\n                    .toLowerCase()\r\n                    .trim()\r\n                    .includes(cleanedQuery);\r\n                  const matchesEmail = attendee.email\r\n                    .toLowerCase()\r\n                    .trim()\r\n                    .includes(cleanedQuery);\r\n                  const matchesTwitter = getContactTwitter(attendee)\r\n                    .toLowerCase()\r\n                    .trim()\r\n                    .includes(cleanedQuery);\r\n\r\n                  attendeesSearchRankingScore[`${attendee.id}`] = 0;\r\n                  if (matchesName || matchesEmail || matchesTwitter) {\r\n                    filteredAttendees.push(attendee);\r\n                  }\r\n                  if (matchesName) {\r\n                    attendeesSearchRankingScore[`${attendee.id}`] += 1;\r\n                  }\r\n                  if (matchesEmail) {\r\n                    attendeesSearchRankingScore[`${attendee.id}`] += 1;\r\n                  }\r\n                  if (matchesTwitter) {\r\n                    attendeesSearchRankingScore[`${attendee.id}`] += 1;\r\n                  }\r\n                });\r\n                const sortedFilteredAttendees = _.orderBy(\r\n                  filteredAttendees,\r\n                  attendee => attendeesSearchRankingScore[`${attendee.id}`],\r\n                  ['desc']\r\n                );\r\n                attendeesData = sortedFilteredAttendees;\r\n              }\r\n\r\n              return (\r\n                <AttendeesSearchResults\r\n                  attendees={attendeesData}\r\n                  onPress={this._handlePressRow}\r\n                  searchQuery={cleanedQuery}\r\n                  isLoading={loading}\r\n                  event={this.props.event}\r\n                />\r\n              );\r\n            }}\r\n          </Query>\r\n        ) : null}\r\n      </AnimatableView>\r\n    );\r\n  }\r\n}\r\n\r\nconst OverscrollView = () => (\r\n  <View\r\n    style={{\r\n      position: 'absolute',\r\n      top: -400,\r\n      height: 400,\r\n      left: 0,\r\n      right: 0,\r\n      backgroundColor: Colors.blue,\r\n    }}\r\n  />\r\n);\r\n\r\nconst styles = StyleSheet.create({\r\n  textInput: {\r\n    height: 60,\r\n    position: 'absolute',\r\n    top: Layout.notchHeight,\r\n    left: 0,\r\n    right: 0,\r\n    marginLeft: 6,\r\n    marginRight: 6,\r\n    zIndex: 10,\r\n    backgroundColor: 'white',\r\n    padding: 5,\r\n    borderRadius: 4,\r\n    borderWidth: 0,\r\n    borderColor: 'black',\r\n  },\r\n});\r\n\r\nexport default Attendees;\r\n"]},"metadata":{},"sourceType":"module"}