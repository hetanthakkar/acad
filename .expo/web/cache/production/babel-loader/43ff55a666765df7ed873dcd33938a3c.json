{"ast":null,"code":"import _extends from\"@babel/runtime/helpers/extends\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import PropTypes from'prop-types';import React from'react';import FlatList from\"react-native-web/dist/exports/FlatList\";import View from\"react-native-web/dist/exports/View\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Text from\"react-native-web/dist/exports/Text\";import Platform from\"react-native-web/dist/exports/Platform\";import LoadEarlier from\"./LoadEarlier\";import Message from\"./Message\";import Color from\"./Color\";import{warning,StylePropType}from\"./utils\";import TypingIndicator from\"./TypingIndicator\";var styles=StyleSheet.create({container:{flex:1},containerAlignTop:{flexDirection:'row',alignItems:'flex-start'},contentContainerStyle:{flexGrow:1,justifyContent:'flex-start'},emptyChatContainer:{flex:1,transform:[{scaleY:-1}]},headerWrapper:{flex:1},listStyle:{flex:1},scrollToBottomStyle:{opacity:0.8,position:'absolute',right:10,bottom:30,zIndex:999,height:40,width:40,borderRadius:20,backgroundColor:Color.white,alignItems:'center',justifyContent:'center',shadowColor:Color.black,shadowOpacity:0.5,shadowOffset:{width:0,height:0},shadowRadius:1}});var MessageContainer=function(_React$PureComponent){_inherits(MessageContainer,_React$PureComponent);var _super=_createSuper(MessageContainer);function MessageContainer(){var _this;_classCallCheck(this,MessageContainer);_this=_super.apply(this,arguments);_this.state={showScrollBottom:false};_this.attachKeyboardListeners=function(){var invertibleProps=_this.props.invertibleScrollViewProps;if(invertibleProps){Keyboard.addListener('keyboardWillShow',invertibleProps.onKeyboardWillShow);Keyboard.addListener('keyboardDidShow',invertibleProps.onKeyboardDidShow);Keyboard.addListener('keyboardWillHide',invertibleProps.onKeyboardWillHide);Keyboard.addListener('keyboardDidHide',invertibleProps.onKeyboardDidHide);}};_this.detachKeyboardListeners=function(){var invertibleProps=_this.props.invertibleScrollViewProps;Keyboard.removeListener('keyboardWillShow',invertibleProps.onKeyboardWillShow);Keyboard.removeListener('keyboardDidShow',invertibleProps.onKeyboardDidShow);Keyboard.removeListener('keyboardWillHide',invertibleProps.onKeyboardWillHide);Keyboard.removeListener('keyboardDidHide',invertibleProps.onKeyboardDidHide);};_this.renderTypingIndicator=function(){if(Platform.OS==='web'){return null;}return React.createElement(TypingIndicator,{isTyping:_this.props.isTyping||false});};_this.renderFooter=function(){if(_this.props.renderFooter){return _this.props.renderFooter(_this.props);}return _this.renderTypingIndicator();};_this.renderLoadEarlier=function(){if(_this.props.loadEarlier===true){var loadEarlierProps=_objectSpread({},_this.props);if(_this.props.renderLoadEarlier){return _this.props.renderLoadEarlier(loadEarlierProps);}return React.createElement(LoadEarlier,loadEarlierProps);}return null;};_this.scrollToBottom=function(){var animated=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var inverted=_this.props.inverted;if(inverted){_this.scrollTo({offset:0,animated:animated});}else if(_this.props.forwardRef&&_this.props.forwardRef.current){_this.props.forwardRef.current.scrollToEnd({animated:animated});}};_this.handleOnScroll=function(event){var _event$nativeEvent=event.nativeEvent,contentOffsetY=_event$nativeEvent.contentOffset.y,contentSizeHeight=_event$nativeEvent.contentSize.height,layoutMeasurementHeight=_event$nativeEvent.layoutMeasurement.height;var scrollToBottomOffset=_this.props.scrollToBottomOffset;if(_this.props.inverted){if(contentOffsetY>scrollToBottomOffset){_this.setState({showScrollBottom:true});}else{_this.setState({showScrollBottom:false});}}else{if(contentOffsetY<scrollToBottomOffset&&contentSizeHeight-layoutMeasurementHeight>scrollToBottomOffset){_this.setState({showScrollBottom:true});}else{_this.setState({showScrollBottom:false});}}};_this.renderRow=function(_ref){var item=_ref.item,index=_ref.index;if(!item._id&&item._id!==0){warning('GiftedChat: `_id` is missing for message',JSON.stringify(item));}if(!item.user){if(!item.system){warning('GiftedChat: `user` is missing for message',JSON.stringify(item));}item.user={_id:0};}var _this$props=_this.props,messages=_this$props.messages,user=_this$props.user,inverted=_this$props.inverted,restProps=_objectWithoutProperties(_this$props,[\"messages\",\"user\",\"inverted\"]);if(messages&&user){var previousMessage=(inverted?messages[index+1]:messages[index-1])||{};var nextMessage=(inverted?messages[index-1]:messages[index+1])||{};var messageProps=_objectSpread(_objectSpread({},restProps),{},{user:user,key:item._id,currentMessage:item,previousMessage:previousMessage,inverted:inverted,nextMessage:nextMessage,position:item.user._id===user._id?'right':'left'});if(_this.props.renderMessage){return _this.props.renderMessage(messageProps);}return React.createElement(Message,messageProps);}return null;};_this.renderChatEmpty=function(){if(_this.props.renderChatEmpty){return _this.props.inverted?_this.props.renderChatEmpty():React.createElement(View,{style:styles.emptyChatContainer},_this.props.renderChatEmpty());}return React.createElement(View,{style:styles.container});};_this.renderHeaderWrapper=function(){return React.createElement(View,{style:styles.headerWrapper},_this.renderLoadEarlier());};_this.onLayoutList=function(){if(!_this.props.inverted&&!!_this.props.messages&&_this.props.messages.length){setTimeout(function(){return _this.scrollToBottom&&_this.scrollToBottom(false);},15*_this.props.messages.length);}};_this.onEndReached=function(_ref2){var distanceFromEnd=_ref2.distanceFromEnd;var _this$props2=_this.props,loadEarlier=_this$props2.loadEarlier,onLoadEarlier=_this$props2.onLoadEarlier,infiniteScroll=_this$props2.infiniteScroll,isLoadingEarlier=_this$props2.isLoadingEarlier;if(infiniteScroll&&distanceFromEnd>0&&distanceFromEnd<=100&&loadEarlier&&onLoadEarlier&&!isLoadingEarlier&&Platform.OS!=='web'){onLoadEarlier();}};_this.keyExtractor=function(item){return\"\"+item._id;};return _this;}_createClass(MessageContainer,[{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.messages&&this.props.messages.length===0){this.attachKeyboardListeners();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.detachKeyboardListeners();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(prevProps.messages&&prevProps.messages.length===0&&this.props.messages&&this.props.messages.length>0){this.detachKeyboardListeners();}else if(prevProps.messages&&this.props.messages&&prevProps.messages.length>0&&this.props.messages.length===0){this.attachKeyboardListeners();}}},{key:\"scrollTo\",value:function scrollTo(options){if(this.props.forwardRef&&this.props.forwardRef.current&&options){this.props.forwardRef.current.scrollToOffset(options);}}},{key:\"renderScrollBottomComponent\",value:function renderScrollBottomComponent(){var scrollToBottomComponent=this.props.scrollToBottomComponent;if(scrollToBottomComponent){return scrollToBottomComponent();}return React.createElement(Text,null,\"V\");}},{key:\"renderScrollToBottomWrapper\",value:function renderScrollToBottomWrapper(){var _this2=this;var propsStyle=this.props.scrollToBottomStyle||{};return React.createElement(View,{style:[styles.scrollToBottomStyle,propsStyle]},React.createElement(TouchableOpacity,{onPress:function onPress(){return _this2.scrollToBottom();},hitSlop:{top:5,left:5,right:5,bottom:5}},this.renderScrollBottomComponent()));}},{key:\"render\",value:function render(){var inverted=this.props.inverted;return React.createElement(View,{style:this.props.alignTop?styles.containerAlignTop:styles.container},this.state.showScrollBottom&&this.props.scrollToBottom?this.renderScrollToBottomWrapper():null,React.createElement(FlatList,_extends({ref:this.props.forwardRef,extraData:[this.props.extraData,this.props.isTyping],keyExtractor:this.keyExtractor,enableEmptySections:true,automaticallyAdjustContentInsets:false,inverted:inverted,data:this.props.messages,style:styles.listStyle,contentContainerStyle:styles.contentContainerStyle,renderItem:this.renderRow},this.props.invertibleScrollViewProps,{ListEmptyComponent:this.renderChatEmpty,ListFooterComponent:inverted?this.renderHeaderWrapper:this.renderFooter,ListHeaderComponent:inverted?this.renderFooter:this.renderHeaderWrapper,onScroll:this.handleOnScroll,scrollEventThrottle:100,onLayout:this.onLayoutList,onEndReached:this.onEndReached,onEndReachedThreshold:0.1},this.props.listViewProps)));}}]);return MessageContainer;}(React.PureComponent);export{MessageContainer as default};MessageContainer.defaultProps={messages:[],user:{},isTyping:false,renderChatEmpty:null,renderFooter:null,renderMessage:null,onLoadEarlier:function onLoadEarlier(){},onQuickReply:function onQuickReply(){},inverted:true,loadEarlier:false,listViewProps:{},invertibleScrollViewProps:{},extraData:null,scrollToBottom:false,scrollToBottomOffset:200,alignTop:false,scrollToBottomStyle:{},infiniteScroll:false,isLoadingEarlier:false};MessageContainer.propTypes={messages:PropTypes.arrayOf(PropTypes.object),isTyping:PropTypes.bool,user:PropTypes.object,renderChatEmpty:PropTypes.func,renderFooter:PropTypes.func,renderMessage:PropTypes.func,renderLoadEarlier:PropTypes.func,onLoadEarlier:PropTypes.func,listViewProps:PropTypes.object,inverted:PropTypes.bool,loadEarlier:PropTypes.bool,invertibleScrollViewProps:PropTypes.object,extraData:PropTypes.array,scrollToBottom:PropTypes.bool,scrollToBottomOffset:PropTypes.number,scrollToBottomComponent:PropTypes.func,alignTop:PropTypes.bool,scrollToBottomStyle:StylePropType,infiniteScroll:PropTypes.bool};","map":{"version":3,"sources":["../src/MessageContainer.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import PropTypes from 'prop-types';\nimport React from 'react';\nimport { FlatList, View, StyleSheet, Keyboard, TouchableOpacity, Text, Platform, } from 'react-native';\nimport LoadEarlier from './LoadEarlier';\nimport Message from './Message';\nimport Color from './Color';\nimport { warning, StylePropType } from './utils';\nimport TypingIndicator from './TypingIndicator';\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n    },\n    containerAlignTop: {\n        flexDirection: 'row',\n        alignItems: 'flex-start',\n    },\n    contentContainerStyle: {\n        flexGrow: 1,\n        justifyContent: 'flex-start',\n    },\n    emptyChatContainer: {\n        flex: 1,\n        transform: [{ scaleY: -1 }],\n    },\n    headerWrapper: {\n        flex: 1,\n    },\n    listStyle: {\n        flex: 1,\n    },\n    scrollToBottomStyle: {\n        opacity: 0.8,\n        position: 'absolute',\n        right: 10,\n        bottom: 30,\n        zIndex: 999,\n        height: 40,\n        width: 40,\n        borderRadius: 20,\n        backgroundColor: Color.white,\n        alignItems: 'center',\n        justifyContent: 'center',\n        shadowColor: Color.black,\n        shadowOpacity: 0.5,\n        shadowOffset: { width: 0, height: 0 },\n        shadowRadius: 1,\n    },\n});\nexport default class MessageContainer extends React.PureComponent {\n    constructor() {\n        super(...arguments);\n        this.state = {\n            showScrollBottom: false,\n        };\n        this.attachKeyboardListeners = () => {\n            const { invertibleScrollViewProps: invertibleProps } = this.props;\n            if (invertibleProps) {\n                Keyboard.addListener('keyboardWillShow', invertibleProps.onKeyboardWillShow);\n                Keyboard.addListener('keyboardDidShow', invertibleProps.onKeyboardDidShow);\n                Keyboard.addListener('keyboardWillHide', invertibleProps.onKeyboardWillHide);\n                Keyboard.addListener('keyboardDidHide', invertibleProps.onKeyboardDidHide);\n            }\n        };\n        this.detachKeyboardListeners = () => {\n            const { invertibleScrollViewProps: invertibleProps } = this.props;\n            Keyboard.removeListener('keyboardWillShow', invertibleProps.onKeyboardWillShow);\n            Keyboard.removeListener('keyboardDidShow', invertibleProps.onKeyboardDidShow);\n            Keyboard.removeListener('keyboardWillHide', invertibleProps.onKeyboardWillHide);\n            Keyboard.removeListener('keyboardDidHide', invertibleProps.onKeyboardDidHide);\n        };\n        this.renderTypingIndicator = () => {\n            if (Platform.OS === 'web') {\n                return null;\n            }\n            return <TypingIndicator isTyping={this.props.isTyping || false}/>;\n        };\n        this.renderFooter = () => {\n            if (this.props.renderFooter) {\n                return this.props.renderFooter(this.props);\n            }\n            return this.renderTypingIndicator();\n        };\n        this.renderLoadEarlier = () => {\n            if (this.props.loadEarlier === true) {\n                const loadEarlierProps = {\n                    ...this.props,\n                };\n                if (this.props.renderLoadEarlier) {\n                    return this.props.renderLoadEarlier(loadEarlierProps);\n                }\n                return <LoadEarlier {...loadEarlierProps}/>;\n            }\n            return null;\n        };\n        this.scrollToBottom = (animated = true) => {\n            const { inverted } = this.props;\n            if (inverted) {\n                this.scrollTo({ offset: 0, animated });\n            }\n            else if (this.props.forwardRef && this.props.forwardRef.current) {\n                this.props.forwardRef.current.scrollToEnd({ animated });\n            }\n        };\n        this.handleOnScroll = (event) => {\n            const { nativeEvent: { contentOffset: { y: contentOffsetY }, contentSize: { height: contentSizeHeight }, layoutMeasurement: { height: layoutMeasurementHeight }, }, } = event;\n            const { scrollToBottomOffset } = this.props;\n            if (this.props.inverted) {\n                if (contentOffsetY > scrollToBottomOffset) {\n                    this.setState({ showScrollBottom: true });\n                }\n                else {\n                    this.setState({ showScrollBottom: false });\n                }\n            }\n            else {\n                if (contentOffsetY < scrollToBottomOffset &&\n                    contentSizeHeight - layoutMeasurementHeight > scrollToBottomOffset) {\n                    this.setState({ showScrollBottom: true });\n                }\n                else {\n                    this.setState({ showScrollBottom: false });\n                }\n            }\n        };\n        this.renderRow = ({ item, index }) => {\n            if (!item._id && item._id !== 0) {\n                warning('GiftedChat: `_id` is missing for message', JSON.stringify(item));\n            }\n            if (!item.user) {\n                if (!item.system) {\n                    warning('GiftedChat: `user` is missing for message', JSON.stringify(item));\n                }\n                item.user = { _id: 0 };\n            }\n            const { messages, user, inverted, ...restProps } = this.props;\n            if (messages && user) {\n                const previousMessage = (inverted ? messages[index + 1] : messages[index - 1]) || {};\n                const nextMessage = (inverted ? messages[index - 1] : messages[index + 1]) || {};\n                const messageProps = {\n                    ...restProps,\n                    user,\n                    key: item._id,\n                    currentMessage: item,\n                    previousMessage,\n                    inverted,\n                    nextMessage,\n                    position: item.user._id === user._id ? 'right' : 'left',\n                };\n                if (this.props.renderMessage) {\n                    return this.props.renderMessage(messageProps);\n                }\n                return <Message {...messageProps}/>;\n            }\n            return null;\n        };\n        this.renderChatEmpty = () => {\n            if (this.props.renderChatEmpty) {\n                return this.props.inverted ? (this.props.renderChatEmpty()) : (<View style={styles.emptyChatContainer}>\n          {this.props.renderChatEmpty()}\n        </View>);\n            }\n            return <View style={styles.container}/>;\n        };\n        this.renderHeaderWrapper = () => (<View style={styles.headerWrapper}>{this.renderLoadEarlier()}</View>);\n        this.onLayoutList = () => {\n            if (!this.props.inverted &&\n                !!this.props.messages &&\n                this.props.messages.length) {\n                setTimeout(() => this.scrollToBottom && this.scrollToBottom(false), 15 * this.props.messages.length);\n            }\n        };\n        this.onEndReached = ({ distanceFromEnd }) => {\n            const { loadEarlier, onLoadEarlier, infiniteScroll, isLoadingEarlier, } = this.props;\n            if (infiniteScroll &&\n                distanceFromEnd > 0 &&\n                distanceFromEnd <= 100 &&\n                loadEarlier &&\n                onLoadEarlier &&\n                !isLoadingEarlier &&\n                Platform.OS !== 'web') {\n                onLoadEarlier();\n            }\n        };\n        this.keyExtractor = (item) => `${item._id}`;\n    }\n    componentDidMount() {\n        if (this.props.messages && this.props.messages.length === 0) {\n            this.attachKeyboardListeners();\n        }\n    }\n    componentWillUnmount() {\n        this.detachKeyboardListeners();\n    }\n    componentDidUpdate(prevProps) {\n        if (prevProps.messages &&\n            prevProps.messages.length === 0 &&\n            this.props.messages &&\n            this.props.messages.length > 0) {\n            this.detachKeyboardListeners();\n        }\n        else if (prevProps.messages &&\n            this.props.messages &&\n            prevProps.messages.length > 0 &&\n            this.props.messages.length === 0) {\n            this.attachKeyboardListeners();\n        }\n    }\n    scrollTo(options) {\n        if (this.props.forwardRef && this.props.forwardRef.current && options) {\n            this.props.forwardRef.current.scrollToOffset(options);\n        }\n    }\n    renderScrollBottomComponent() {\n        const { scrollToBottomComponent } = this.props;\n        if (scrollToBottomComponent) {\n            return scrollToBottomComponent();\n        }\n        return <Text>V</Text>;\n    }\n    renderScrollToBottomWrapper() {\n        const propsStyle = this.props.scrollToBottomStyle || {};\n        return (<View style={[styles.scrollToBottomStyle, propsStyle]}>\n        <TouchableOpacity onPress={() => this.scrollToBottom()} hitSlop={{ top: 5, left: 5, right: 5, bottom: 5 }}>\n          {this.renderScrollBottomComponent()}\n        </TouchableOpacity>\n      </View>);\n    }\n    render() {\n        const { inverted } = this.props;\n        return (<View style={this.props.alignTop ? styles.containerAlignTop : styles.container}>\n        {this.state.showScrollBottom && this.props.scrollToBottom\n            ? this.renderScrollToBottomWrapper()\n            : null}\n        <FlatList ref={this.props.forwardRef} extraData={[this.props.extraData, this.props.isTyping]} keyExtractor={this.keyExtractor} enableEmptySections automaticallyAdjustContentInsets={false} inverted={inverted} data={this.props.messages} style={styles.listStyle} contentContainerStyle={styles.contentContainerStyle} renderItem={this.renderRow} {...this.props.invertibleScrollViewProps} ListEmptyComponent={this.renderChatEmpty} ListFooterComponent={inverted ? this.renderHeaderWrapper : this.renderFooter} ListHeaderComponent={inverted ? this.renderFooter : this.renderHeaderWrapper} onScroll={this.handleOnScroll} scrollEventThrottle={100} onLayout={this.onLayoutList} onEndReached={this.onEndReached} onEndReachedThreshold={0.1} {...this.props.listViewProps}/>\n      </View>);\n    }\n}\nMessageContainer.defaultProps = {\n    messages: [],\n    user: {},\n    isTyping: false,\n    renderChatEmpty: null,\n    renderFooter: null,\n    renderMessage: null,\n    onLoadEarlier: () => { },\n    onQuickReply: () => { },\n    inverted: true,\n    loadEarlier: false,\n    listViewProps: {},\n    invertibleScrollViewProps: {},\n    extraData: null,\n    scrollToBottom: false,\n    scrollToBottomOffset: 200,\n    alignTop: false,\n    scrollToBottomStyle: {},\n    infiniteScroll: false,\n    isLoadingEarlier: false,\n};\nMessageContainer.propTypes = {\n    messages: PropTypes.arrayOf(PropTypes.object),\n    isTyping: PropTypes.bool,\n    user: PropTypes.object,\n    renderChatEmpty: PropTypes.func,\n    renderFooter: PropTypes.func,\n    renderMessage: PropTypes.func,\n    renderLoadEarlier: PropTypes.func,\n    onLoadEarlier: PropTypes.func,\n    listViewProps: PropTypes.object,\n    inverted: PropTypes.bool,\n    loadEarlier: PropTypes.bool,\n    invertibleScrollViewProps: PropTypes.object,\n    extraData: PropTypes.array,\n    scrollToBottom: PropTypes.bool,\n    scrollToBottomOffset: PropTypes.number,\n    scrollToBottomComponent: PropTypes.func,\n    alignTop: PropTypes.bool,\n    scrollToBottomStyle: StylePropType,\n    infiniteScroll: PropTypes.bool,\n};\n//# sourceMappingURL=MessageContainer.js.map"]},"metadata":{},"sourceType":"module"}