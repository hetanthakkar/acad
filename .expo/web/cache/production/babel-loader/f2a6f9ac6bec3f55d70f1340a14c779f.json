{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from\"react\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import BackHandler from\"react-native-web/dist/exports/BackHandler\";import{Item,Input,Icon,Button,Header}from\"native-base\";import Mycard from\"./mycard\";import firebase from\"firebase\";var firebaseConfig={apiKey:\"AIzaSyAfGN94rWhA55dceve-ab5R5nEL6o4xXeg\",authDomain:\"new1-930be.firebaseapp.com\",databaseURL:\"https://new1-930be.firebaseio.com\",projectId:\"new1-930be\",storageBucket:\"new1-930be.appspot.com\",messagingSenderId:\"332990256430\",appId:\"1:332990256430:web:640a6413492c34bf2a96bf\",measurementId:\"G-SBPS6449GM\"};if(!firebase.apps.length){firebase.initializeApp(firebaseConfig);}var messagesRecieved,k,seen,renderMessage;var messages=[];var temp=[];var temp1=[];var temp2=[];var temp3=[];var temp4=[];var noOfMessagesRecieved,noOfMessagesSent;var screenWidth=Math.round(Dimensions.get(\"window\").width)/100;var screenHeight=Math.round(Dimensions.get(\"window\").height)/100;var SearchScreen=function(_React$Component){_inherits(SearchScreen,_React$Component);var _super=_createSuper(SearchScreen);function SearchScreen(){var _this;_classCallCheck(this,SearchScreen);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={bar:\"\",pub:[],seen:[],messages:[],renderMessage:[],temp3:[],temp2:[],temp:[],temp1:[],noOfMessagesRecieved:0,noOfMessagesSent:0};_this.onChange=function _callee(bar){return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(_this.setState({bar:bar}));case 2:case\"end\":return _context.stop();}}},null,null,null,Promise);};_this.handleBackButton=function(){_this.props.navigation.navigate(\"Profile\");return true;};return _this;}_createClass(SearchScreen,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){BackHandler.removeEventListener(\"hardwareBackPress\",this.handleBackButton);this.setState({messages:[]});this.setState({renderMessage:[]});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var i,_i,_loop,_i2;return _regeneratorRuntime.async(function componentDidMount$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"mudde\",this.props);temp3=this.state.temp3;temp2=this.state.temp2;temp2=this.state.temp1;temp=this.state.temp;BackHandler.addEventListener(\"hardwareBackPress\",this.handleBackButton);_context5.next=8;return _regeneratorRuntime.awrap(this.setState({currentId:0}));case 8:noOfMessagesSent=this.state.noOfMessagesSent;_context5.next=11;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+0+\"/noOfMessagesSent\").on(\"value\",function _callee2(snapshot){return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:noOfMessagesSent=snapshot.val();console.log(snapshot.val());_context2.next=4;return _regeneratorRuntime.awrap(_this2.setState({noOfMessagesSent:noOfMessagesSent}));case 4:case\"end\":return _context2.stop();}}},null,null,null,Promise);}));case 11:console.log({noOfMessagesSent:noOfMessagesSent});_context5.next=14;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+0+\"/messagesRecieved\").on(\"value\",function(snapshot){messagesRecieved=snapshot.val();}));case 14:noOfMessagesRecieved=this.state.noOfMessagesRecieved;_context5.next=17;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+0+\"/noOfMessagesRecieved\").on(\"value\",function _callee3(snapshot){return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:noOfMessagesRecieved=snapshot.val();_context3.next=3;return _regeneratorRuntime.awrap(_this2.setState({noOfMessagesRecieved:noOfMessagesRecieved}));case 3:case\"end\":return _context3.stop();}}},null,null,null,Promise);}));case 17:console.log(\"noOfMessagesSent\",this.state.noOfMessagesSent);i=noOfMessagesSent;case 19:if(!(i>=1)){_context5.next=26;break;}console.log(noOfMessagesSent);_context5.next=23;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+0+\"/messagesSent/\"+i).on(\"value\",function(snapshot){if(!temp.includes(snapshot.val().message.to))temp1.push(snapshot.val());console.log(snapshot.val());temp.push(snapshot.val().message.to);}));case 23:i--;_context5.next=19;break;case 26:_i=noOfMessagesRecieved;case 27:if(!(_i>=1)){_context5.next=33;break;}_context5.next=30;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+0+\"/messagesRecieved/\"+_i).on(\"value\",function(snapshot){if(!temp2.includes(snapshot.val().message.from)){temp3.push(snapshot.val());}temp2.push(snapshot.val().message.from);}));case 30:_i--;_context5.next=27;break;case 33:messages=[].concat(_toConsumableArray(temp3),temp1);messages=Object.keys(messages).sort(function(a,b){return Date.parse(messages[a].message.createdAt)-Date.parse(messages[b].message.createdAt);}).map(function(k){return messages[k];});seen=this.state.seen;for(k=messages.length-1;k>=0;k--){if(messages[k].message.from||messages[k].message.from==0){if(seen.includes(messages[k].message.from)){messages.splice(k,1);}seen.push(messages[k].message.from);}else{if(seen.includes(messages[k].message.to)){messages.splice(k,1);}seen.push(messages[k].message.to);}}messages=Object.keys(messages).sort(function(a,b){return Date.parse(messages[a].message.createdAt)-Date.parse(messages[b].message.createdAt);}).map(function(k){return messages[k];});_context5.next=40;return _regeneratorRuntime.awrap(this.setState({messages:messages}));case 40:renderMessage=this.state.renderMessage;_loop=function _loop(_i2){return _regeneratorRuntime.async(function _loop$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(_this2.state.messages[_i2].message.to||_this2.state.messages[_i2].message.to==0)){_context4.next=5;break;}_context4.next=3;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+_this2.state.messages[_i2].message.to).on(\"value\",function(snapshot){renderMessage.push({name:snapshot.val().name,photo:snapshot.val().photo,chat:_this2.state.messages[_i2].message.text});}));case 3:_context4.next=7;break;case 5:_context4.next=7;return _regeneratorRuntime.awrap(firebase.database().ref(\"user/\"+_this2.state.messages[_i2].message.from).on(\"value\",function(snapshot){renderMessage.push({name:snapshot.val().name,photo:snapshot.val().photo,chat:_this2.state.messages[_i2].message.text});}));case 7:_context4.next=9;return _regeneratorRuntime.awrap(_this2.setState({renderMessage:renderMessage}));case 9:case\"end\":return _context4.stop();}}},null,null,null,Promise);};_i2=0;case 43:if(!(_i2<this.state.messages.length)){_context5.next=49;break;}_context5.next=46;return _regeneratorRuntime.awrap(_loop(_i2));case 46:_i2++;_context5.next=43;break;case 49:this.setState({renderMessage:[{chat:\"Fiji\",name:\"hetan\",photo:\"https://firebasestorage.googleapis.com/v0/b/new1-930be.appspot.com/o/ksjdnf?alt=media&token=9514dc1f-f459-4473-a7c0-ab13a5820d47\"}]});console.log({renderMessage:renderMessage});case 51:case\"end\":return _context5.stop();}}},null,this,null,Promise);}},{key:\"render\",value:function render(){return React.createElement(View,null,React.createElement(ScrollView,null,React.createElement(Header,{searchBar:true,rounded:true,autoCorrect:false,style:{height:screenHeight*12,backgroundColor:\"#3498db\"}},React.createElement(Item,{style:{marginTop:-screenHeight*2}},React.createElement(Icon,{name:\"ios-search\"}),React.createElement(Input,{value:this.state.bar,onChangeText:this.onChange}),React.createElement(Icon,{name:\"ios-people\"})),React.createElement(Button,{transparent:true})),this.state.renderMessage.map(function(value){return React.createElement(TouchableOpacity,null,React.createElement(Mycard,{name:value.name,chat:value.chat,photo:value.photo}));})));}}]);return SearchScreen;}(React.Component);SearchScreen.navigationOptions={drawerLabel:\"search\"};export{SearchScreen as default};","map":{"version":3,"sources":["C:/Users/codemaxx/Desktop/iBlood/mobileChat.js"],"names":["React","Item","Input","Icon","Button","Header","Mycard","firebase","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","apps","length","initializeApp","messagesRecieved","k","seen","renderMessage","messages","temp","temp1","temp2","temp3","temp4","noOfMessagesRecieved","noOfMessagesSent","screenWidth","Math","round","Dimensions","get","width","screenHeight","height","SearchScreen","state","bar","pub","onChange","setState","handleBackButton","props","navigation","navigate","BackHandler","removeEventListener","console","log","addEventListener","currentId","database","ref","on","snapshot","val","i","includes","message","to","push","from","Object","keys","sort","a","b","Date","parse","createdAt","map","splice","name","photo","chat","text","backgroundColor","marginTop","value","Component","navigationOptions","drawerLabel"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {\r\n  Text,\r\n  View,\r\n  ScrollView,\r\n  Dimensions,\r\n  TouchableOpacity,\r\n  BackHandler,\r\n} from \"react-native\";\r\nimport { Item, Input, Icon, Button, Header } from \"native-base\";\r\nimport Mycard from \"./mycard\";\r\nimport firebase from \"firebase\";\r\nvar firebaseConfig = {\r\n  apiKey: \"AIzaSyAfGN94rWhA55dceve-ab5R5nEL6o4xXeg\",\r\n  authDomain: \"new1-930be.firebaseapp.com\",\r\n  databaseURL: \"https://new1-930be.firebaseio.com\",\r\n  projectId: \"new1-930be\",\r\n  storageBucket: \"new1-930be.appspot.com\",\r\n  messagingSenderId: \"332990256430\",\r\n  appId: \"1:332990256430:web:640a6413492c34bf2a96bf\",\r\n  measurementId: \"G-SBPS6449GM\",\r\n};\r\n\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\nvar messagesRecieved, k, seen, renderMessage;\r\nvar messages = [];\r\nvar temp = [];\r\nvar temp1 = [];\r\nvar temp2 = [];\r\nvar temp3 = [];\r\nvar temp4 = [];\r\nvar noOfMessagesRecieved, noOfMessagesSent;\r\nconst screenWidth = Math.round(Dimensions.get(\"window\").width) / 100;\r\nconst screenHeight = Math.round(Dimensions.get(\"window\").height) / 100;\r\nexport default class SearchScreen extends React.Component {\r\n  state = {\r\n    bar: \"\",\r\n    pub: [],\r\n    seen: [],\r\n    messages: [],\r\n    renderMessage: [],\r\n    temp3: [],\r\n    temp2: [],\r\n    temp: [],\r\n    temp1: [],\r\n    noOfMessagesRecieved: 0,\r\n    noOfMessagesSent: 0,\r\n  };\r\n  static navigationOptions = {\r\n    drawerLabel: \"search\",\r\n  };\r\n  onChange = async (bar) => {\r\n    await this.setState({ bar: bar });\r\n  };\r\n  componentWillUnmount() {\r\n    BackHandler.removeEventListener(\"hardwareBackPress\", this.handleBackButton);\r\n    this.setState({ messages: [] });\r\n    this.setState({ renderMessage: [] });\r\n  }\r\n  handleBackButton = () => {\r\n    this.props.navigation.navigate(\"Profile\");\r\n    return true;\r\n  };\r\n\r\n  async componentDidMount() {\r\n    console.log(\"mudde\", this.props);\r\n    temp3 = this.state.temp3;\r\n    temp2 = this.state.temp2;\r\n    temp2 = this.state.temp1;\r\n    temp = this.state.temp;\r\n    BackHandler.addEventListener(\"hardwareBackPress\", this.handleBackButton);\r\n    await this.setState({ currentId: 0 });\r\n    noOfMessagesSent = this.state.noOfMessagesSent;\r\n    await firebase\r\n      .database()\r\n      .ref(\"user/\" + 0 + \"/noOfMessagesSent\")\r\n      .on(\"value\", async (snapshot) => {\r\n        noOfMessagesSent = snapshot.val();\r\n        console.log(snapshot.val());\r\n        await this.setState({ noOfMessagesSent });\r\n      });\r\n    console.log({ noOfMessagesSent });\r\n    await firebase\r\n      .database()\r\n      .ref(\"user/\" + 0 + \"/messagesRecieved\")\r\n      .on(\"value\", (snapshot) => {\r\n        messagesRecieved = snapshot.val();\r\n      });\r\n    noOfMessagesRecieved = this.state.noOfMessagesRecieved;\r\n    await firebase\r\n      .database()\r\n      .ref(\"user/\" + 0 + \"/noOfMessagesRecieved\")\r\n      .on(\"value\", async (snapshot) => {\r\n        // console.log(\"enterer\");\r\n        // console.log(noOfMessagesRecieved);\r\n        noOfMessagesRecieved = snapshot.val();\r\n        //  console.log(noOfMessagesRecieved);\r\n        await this.setState({ noOfMessagesRecieved });\r\n      });\r\n    console.log(\"noOfMessagesSent\", this.state.noOfMessagesSent);\r\n    for (let i = noOfMessagesSent; i >= 1; i--) {\r\n      console.log(noOfMessagesSent);\r\n      await firebase\r\n        .database()\r\n        .ref(\"user/\" + 0 + \"/messagesSent/\" + i)\r\n        .on(\"value\", (snapshot) => {\r\n          if (!temp.includes(snapshot.val().message.to))\r\n            temp1.push(snapshot.val());\r\n          console.log(snapshot.val());\r\n          temp.push(snapshot.val().message.to);\r\n        });\r\n    }\r\n    // console.log(temp1);\r\n    //  console.log(\"noOfMessagesRecieved\", this.state.noOfMessagesRecieved);\r\n    for (let i = noOfMessagesRecieved; i >= 1; i--) {\r\n      //console.log(\"saldhashdiuashdiuashd\");\r\n      await firebase\r\n        .database()\r\n        .ref(\"user/\" + 0 + \"/messagesRecieved/\" + i)\r\n        .on(\"value\", (snapshot) => {\r\n          //    console.log(\"i is \", i);\r\n          //  console.log(snapshot.val().message);\r\n          if (!temp2.includes(snapshot.val().message.from)) {\r\n            //   console.log(\"object\");\r\n            temp3.push(snapshot.val());\r\n          }\r\n          temp2.push(snapshot.val().message.from);\r\n        });\r\n      //  console.log(\"returned\");\r\n    }\r\n    // console.log(\"alsjnoahndoashouashfoah\");\r\n    messages = [...temp3, ...temp1];\r\n    messages = Object.keys(messages)\r\n      .sort(\r\n        (a, b) =>\r\n          Date.parse(messages[a].message.createdAt) -\r\n          Date.parse(messages[b].message.createdAt)\r\n      )\r\n      .map((k) => messages[k]);\r\n\r\n    seen = this.state.seen;\r\n    for (k = messages.length - 1; k >= 0; k--) {\r\n      //   console.log(\"k\", k);\r\n      if (messages[k].message.from || messages[k].message.from == 0) {\r\n        if (seen.includes(messages[k].message.from)) {\r\n          messages.splice(k, 1);\r\n        }\r\n        //   console.log(seen);\r\n        seen.push(messages[k].message.from);\r\n        //  console.log(seen);\r\n      } else {\r\n        if (seen.includes(messages[k].message.to)) {\r\n          messages.splice(k, 1);\r\n        }\r\n        seen.push(messages[k].message.to);\r\n      }\r\n      // console.log(\" message  becomes\", messages);\r\n    }\r\n    //   console.log(messages);\r\n    messages = Object.keys(messages)\r\n      .sort(\r\n        (a, b) =>\r\n          Date.parse(messages[a].message.createdAt) -\r\n          Date.parse(messages[b].message.createdAt)\r\n      )\r\n      .map((k) => messages[k]);\r\n    await this.setState({ messages });\r\n    // console.log(\"ready\");\r\n    renderMessage = this.state.renderMessage;\r\n    for (let i = 0; i < this.state.messages.length; i++) {\r\n      if (\r\n        this.state.messages[i].message.to ||\r\n        this.state.messages[i].message.to == 0\r\n      ) {\r\n        // console.log(\"entered ti\");\r\n        await firebase\r\n          .database()\r\n          .ref(\"user/\" + this.state.messages[i].message.to)\r\n          .on(\"value\", (snapshot) => {\r\n            renderMessage.push({\r\n              name: snapshot.val().name,\r\n              photo: snapshot.val().photo,\r\n              chat: this.state.messages[i].message.text,\r\n            });\r\n          });\r\n      } else {\r\n        await firebase\r\n          .database()\r\n          .ref(\"user/\" + this.state.messages[i].message.from)\r\n          .on(\"value\", (snapshot) => {\r\n            renderMessage.push({\r\n              name: snapshot.val().name,\r\n              photo: snapshot.val().photo,\r\n              chat: this.state.messages[i].message.text,\r\n            });\r\n          });\r\n      }\r\n      //  console.log(\"alsjndkasndknkiu\");\r\n      await this.setState({ renderMessage });\r\n      //   console.log(this.state.renderMessage);\r\n    }\r\n    this.setState({\r\n      renderMessage: [\r\n        {\r\n          chat: \"Fiji\",\r\n          name: \"hetan\",\r\n          photo:\r\n            \"https://firebasestorage.googleapis.com/v0/b/new1-930be.appspot.com/o/ksjdnf?alt=media&token=9514dc1f-f459-4473-a7c0-ab13a5820d47\",\r\n        },\r\n      ],\r\n    });\r\n    console.log({ renderMessage });\r\n  }\r\n  render() {\r\n    return (\r\n      <View>\r\n        <ScrollView>\r\n          <Header\r\n            searchBar\r\n            rounded\r\n            autoCorrect={false}\r\n            style={{ height: screenHeight * 12, backgroundColor: \"#3498db\" }}\r\n          >\r\n            <Item style={{ marginTop: -screenHeight * 2 }}>\r\n              <Icon name=\"ios-search\" />\r\n              <Input value={this.state.bar} onChangeText={this.onChange} />\r\n              <Icon name=\"ios-people\" />\r\n            </Item>\r\n            <Button transparent></Button>\r\n          </Header>\r\n          {this.state.renderMessage.map((value) => {\r\n            // console.log(value);\r\n            return (\r\n              <TouchableOpacity>\r\n                <Mycard\r\n                  name={value.name}\r\n                  chat={value.chat}\r\n                  photo={value.photo}\r\n                />\r\n              </TouchableOpacity>\r\n            );\r\n          })}\r\n        </ScrollView>\r\n      </View>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}